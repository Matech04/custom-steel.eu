---
import { sanityClient } from "sanity:client";
import Card from "../components/cards/ProjectCard.astro";
import Section from "../components/Section.astro";
import Title from "../components/Title.astro";
import Layout from "./Layout.astro";
import { getRelativeLocaleUrl } from "astro:i18n";
import Badge from "../components/Badge.astro";

const { lang, section } = Astro.params;

const { currentCategory = "", projectsList = [] } = Astro.props;

const projectsSite =
  await sanityClient.fetch(`*[_type == "projects_site"][0] {  ...
}`);

const categoriesList = await sanityClient.fetch(
  `*[_type == "project_categories"]{
  "title": title[$lang],
  "slug": slug[$lang],
  "id": _id
}`,
  { lang },
);
---

<Layout
  title="Projekty | Custom Steel"
  metaDescription="Nasze realizacje"
  lang={lang}
>
  <div class="margin hero-margin">
    <Section bg_element={0}>
      <Title title={projectsSite.title[lang]} />

      <span>{projectsSite?.description?.[lang] || ""}</span>

      <div class="categories">
        {
          categoriesList.lenght !== 0 ? (
            categoriesList.map((category) => {
              return (
                <Badge
                  title={category.title}
                  href={getRelativeLocaleUrl(
                    lang,
                    `${section}/${category.slug}`,
                  )}
                  focus={currentCategory === category.id ? true : false}
                />
              );
            })
          ) : (
            <p />
          )
        }
      </div>

      <div class="projects-grid">
        {
          projectsList.length !== 0 ? (
            projectsList.map((project: any) => (
              <Card
                main_image={project.mainImage}
                title={project.title}
                lang={lang}
                slug={project.slug}
                category={project.categoryTitle}
                category_slug={project.categorySlug}
                href={getRelativeLocaleUrl(
                  lang,
                  `${section}/${project.categorySlug}/${project.slug}`,
                )}
              />
            ))
          ) : (
            <p />
          )
        }
      </div>
    </Section>
  </div>
</Layout>

<style>
  div {
    margin-top: 6rem;
  }

  .categories {
    display: flex;
    gap: 1rem;
  }

  .projects-grid {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 2rem;
    margin-top: 3rem;

    @media (min-width: 1024px) {
      grid-template-columns: repeat(2, 1fr);
    }

    @media (min-width: 1280px) {
      grid-template-columns: repeat(3, 1fr);
    }
  }
</style>
